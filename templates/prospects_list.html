{% extends "base.html" %}

{% block title %}Prospects - CRM Tool{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Prospects</h1>
    <a href="/prospects/new" class="btn btn-primary">+ New Prospect</a>
</div>

{% if prospects %}
<table class="data-table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Company</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Stage</th>
            <th>Estimated Revenue</th>
            <th>Next Follow-Up</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for item in prospects %}
        {% set client = item.client %}
        {% set first_contact = client.contacts[0] if client.contacts else None %}
        <tr>
            <td>{{ first_contact.name if first_contact else client.legal_name }}</td>
            <td>{{ client.legal_name }}</td>
            <td>{{ first_contact.email if first_contact and first_contact.email else '-' }}</td>
            <td>{{ first_contact.phone if first_contact and first_contact.phone else '-' }}</td>
            <td><span class="status-badge status-{{ item.stage.lower().replace(' ', '-') }}">{{ item.stage }}</span></td>
            <td>
                {% if item.estimated_revenue %}
                    ${{ "{:,.0f}".format(item.estimated_revenue) }}
                {% else %}
                    <span class="text-muted">Not specified</span>
                {% endif %}
            </td>
            <td>{{ item.expected_close_date.strftime('%Y-%m-%d') if item.expected_close_date else '-' }}</td>
            <td>
                <a href="/clients/{{ client.id }}" class="btn btn-sm btn-secondary">View</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="empty-state">
    <p>No prospects found.</p>
    <a href="/prospects/new" class="btn btn-primary">Create Your First Prospect</a>
</div>
{% endif %}
{% endblock %}

